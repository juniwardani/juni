<!doctype html>
<html lang="id" class="h-full">
 <head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>JPG to PDF Converter</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="/_sdk/element_sdk.js"></script>
  <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;500;600;700&amp;display=swap" rel="stylesheet">
  <style>
    body {
      box-sizing: border-box;
    }
    * {
      font-family: 'Plus Jakarta Sans', sans-serif;
    }
    .image-item {
      cursor: grab;
      transition: all 0.2s ease;
    }
    .image-item:active {
      cursor: grabbing;
    }
    .image-item.dragging {
      opacity: 0.5;
      transform: scale(0.95);
    }
    .image-item.drag-over {
      border-color: #6366f1 !important;
      background: rgba(99, 102, 241, 0.1);
    }
    .drop-zone.drag-active {
      border-color: #6366f1;
      background: rgba(99, 102, 241, 0.05);
    }
    @keyframes pulse {
      0%, 100% { opacity: 1; }
      50% { opacity: 0.5; }
    }
    .loading {
      animation: pulse 1.5s infinite;
    }
    input[type="range"]::-webkit-slider-thumb {
      appearance: none;
      width: 18px;
      height: 18px;
      border-radius: 50%;
      background: #6366f1;
      cursor: pointer;
      transition: all 0.2s;
    }
    input[type="range"]::-webkit-slider-thumb:hover {
      background: #818cf8;
      transform: scale(1.2);
    }
    input[type="range"]::-moz-range-thumb {
      width: 18px;
      height: 18px;
      border-radius: 50%;
      background: #6366f1;
      cursor: pointer;
      border: none;
      transition: all 0.2s;
    }
    input[type="range"]::-moz-range-thumb:hover {
      background: #818cf8;
      transform: scale(1.2);
    }
    select {
      cursor: pointer;
    }
    select option {
      background: #1e1b4b;
      color: #ffffff;
    }
  </style>
  <style>@view-transition { navigation: auto; }</style>
  <script src="/_sdk/data_sdk.js" type="text/javascript"></script>
 </head>
 <body class="h-full">
  <div id="app-container" class="h-full overflow-auto" style="background: linear-gradient(135deg, #1e1b4b 0%, #312e81 50%, #1e1b4b 100%);">
   <div class="min-h-full p-4 md:p-8">
    <div class="max-w-4xl mx-auto"><!-- Header -->
     <div class="text-center mb-8">
      <div class="inline-flex items-center justify-center w-16 h-16 rounded-2xl mb-4" style="background: #6366f1;">
       <svg class="w-8 h-8" fill="none" stroke="#ffffff" viewbox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z" />
       </svg>
      </div>
      <h1 id="app-title" class="text-3xl md:text-4xl font-bold mb-2" style="color: #ffffff;">JPG to PDF Converter</h1>
      <p style="color: #a5b4fc;">Konversi gambar ke PDF dengan mudah</p>
     </div><!-- Upload Zone -->
     <div id="drop-zone" class="drop-zone border-2 border-dashed rounded-2xl p-8 md:p-12 text-center cursor-pointer transition-all duration-300 mb-6" style="border-color: #4f46e5; background: rgba(99, 102, 241, 0.1);"><input type="file" id="file-input" multiple accept="image/jpeg,image/jpg,image/png,image/webp" class="hidden">
      <svg class="w-16 h-16 mx-auto mb-4" fill="none" stroke="#6366f1" viewbox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12" />
      </svg>
      <p id="upload-text" class="text-lg font-medium mb-2" style="color: #ffffff;">Seret gambar atau klik untuk upload</p>
      <p class="text-sm" style="color: #a5b4fc;">Mendukung JPG, PNG, WebP ‚Ä¢ Tanpa batas jumlah</p>
     </div><!-- PDF Settings -->
     <div id="settings-container" class="hidden mb-6">
      <div class="rounded-xl p-6" style="background: rgba(99, 102, 241, 0.15);">
       <h3 class="text-lg font-semibold mb-4" style="color: #ffffff;">‚öôÔ∏è Pengaturan PDF</h3>
       <div class="grid grid-cols-1 md:grid-cols-2 gap-4"><!-- Paper Size -->
        <div><label for="paper-size" class="block text-sm font-medium mb-2" style="color: #e0e7ff;">Ukuran Kertas</label> <select id="paper-size" class="w-full px-4 py-2 rounded-lg border-0 outline-none focus:ring-2 transition-all" style="background: rgba(255,255,255,0.1); color: #ffffff; focus:ring-color: #6366f1;"> <option value="a4">A4 (210 √ó 297 mm)</option> <option value="f4">F4 (215 √ó 330 mm)</option> <option value="letter">Letter (216 √ó 279 mm)</option> <option value="legal">Legal (216 √ó 356 mm)</option> <option value="a3">A3 (297 √ó 420 mm)</option> <option value="a5">A5 (148 √ó 210 mm)</option> </select>
        </div><!-- Orientation -->
        <div><label for="orientation" class="block text-sm font-medium mb-2" style="color: #e0e7ff;">Orientasi</label> <select id="orientation" class="w-full px-4 py-2 rounded-lg border-0 outline-none focus:ring-2 transition-all" style="background: rgba(255,255,255,0.1); color: #ffffff;"> <option value="portrait">Portrait (Vertikal)</option> <option value="landscape">Landscape (Horizontal)</option> </select>
        </div><!-- Margin -->
        <div><label for="margin" class="block text-sm font-medium mb-2" style="color: #e0e7ff;"> Margin: <span id="margin-value">10</span>mm </label> <input type="range" id="margin" min="0" max="30" value="10" step="1" class="w-full h-2 rounded-lg appearance-none cursor-pointer" style="background: rgba(255,255,255,0.2);">
        </div><!-- Quality -->
        <div><label for="quality" class="block text-sm font-medium mb-2" style="color: #e0e7ff;"> Kualitas Gambar: <span id="quality-value">Tinggi</span> </label> <input type="range" id="quality" min="1" max="3" value="3" step="1" class="w-full h-2 rounded-lg appearance-none cursor-pointer" style="background: rgba(255,255,255,0.2);">
        </div>
       </div>
      </div>
     </div><!-- Image Preview Grid -->
     <div id="preview-container" class="hidden mb-6">
      <div class="flex items-center justify-between mb-4">
       <h2 class="text-lg font-semibold" style="color: #ffffff;">Gambar Terpilih (<span id="image-count">0</span>)</h2><button id="clear-all" class="px-4 py-2 rounded-lg text-sm font-medium transition-all hover:opacity-80" style="background: #ef4444; color: #ffffff;"> Hapus Semua </button>
      </div>
      <p class="text-sm mb-4" style="color: #a5b4fc;">üí° Seret gambar untuk mengatur urutan</p>
      <div id="image-grid" class="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 gap-4"></div>
     </div><!-- Convert Button -->
     <div id="convert-section" class="hidden"><button id="convert-btn" class="w-full py-4 rounded-xl font-semibold text-lg transition-all hover:opacity-90 hover:scale-[1.02] active:scale-[0.98] flex items-center justify-center gap-3" style="background: linear-gradient(135deg, #6366f1, #8b5cf6); color: #ffffff;">
       <svg class="w-6 h-6" fill="none" stroke="currentColor" viewbox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
       </svg><span id="convert-btn-text">Konversi ke PDF</span> </button>
     </div><!-- Progress -->
     <div id="progress-section" class="hidden mt-6">
      <div class="rounded-xl p-6" style="background: rgba(99, 102, 241, 0.2);">
       <div class="flex items-center gap-3 mb-3">
        <div class="w-6 h-6 border-2 border-t-transparent rounded-full animate-spin" style="border-color: #6366f1; border-top-color: transparent;"></div><span class="font-medium" style="color: #ffffff;">Sedang mengkonversi...</span>
       </div>
       <div class="w-full h-2 rounded-full overflow-hidden" style="background: rgba(255,255,255,0.2);">
        <div id="progress-bar" class="h-full rounded-full transition-all duration-300" style="background: #6366f1; width: 0%;"></div>
       </div>
       <p id="progress-text" class="text-sm mt-2" style="color: #a5b4fc;">Memproses gambar 0 dari 0</p>
      </div>
     </div><!-- Success Message -->
     <div id="success-section" class="hidden mt-6">
      <div class="rounded-xl p-6 text-center" style="background: rgba(34, 197, 94, 0.2);">
       <svg class="w-12 h-12 mx-auto mb-3" fill="none" stroke="#22c55e" viewbox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z" />
       </svg>
       <p class="font-semibold text-lg" style="color: #22c55e;">PDF berhasil dibuat!</p>
       <p class="text-sm mt-1" style="color: #a5b4fc;">File PDF telah diunduh ke perangkat Anda</p>
      </div>
     </div><!-- Footer -->
     <p class="text-center text-sm mt-8" style="color: #6366f1;">Dibuat dengan ‚ù§Ô∏è untuk kemudahan Anda</p>
    </div>
   </div>
  </div>
  <script>
    const defaultConfig = {
      app_title: 'JPG to PDF Converter',
      upload_text: 'Seret gambar atau klik untuk upload',
      convert_button_text: 'Konversi ke PDF',
      background_color: '#1e1b4b',
      surface_color: '#6366f1',
      text_color: '#ffffff',
      primary_action_color: '#6366f1',
      secondary_action_color: '#ef4444'
    };

    let images = [];
    let draggedItem = null;

    // DOM Elements
    const dropZone = document.getElementById('drop-zone');
    const fileInput = document.getElementById('file-input');
    const settingsContainer = document.getElementById('settings-container');
    const previewContainer = document.getElementById('preview-container');
    const imageGrid = document.getElementById('image-grid');
    const imageCount = document.getElementById('image-count');
    const convertSection = document.getElementById('convert-section');
    const convertBtn = document.getElementById('convert-btn');
    const clearAllBtn = document.getElementById('clear-all');
    const progressSection = document.getElementById('progress-section');
    const progressBar = document.getElementById('progress-bar');
    const progressText = document.getElementById('progress-text');
    const successSection = document.getElementById('success-section');
    
    // Settings elements
    const paperSizeSelect = document.getElementById('paper-size');
    const orientationSelect = document.getElementById('orientation');
    const marginInput = document.getElementById('margin');
    const marginValue = document.getElementById('margin-value');
    const qualityInput = document.getElementById('quality');
    const qualityValue = document.getElementById('quality-value');

    // Update margin label
    marginInput.addEventListener('input', () => {
      marginValue.textContent = marginInput.value;
    });

    // Update quality label
    qualityInput.addEventListener('input', () => {
      const qualities = ['Rendah', 'Sedang', 'Tinggi'];
      qualityValue.textContent = qualities[parseInt(qualityInput.value) - 1];
    });

    // File handling
    dropZone.addEventListener('click', () => fileInput.click());
    
    dropZone.addEventListener('dragover', (e) => {
      e.preventDefault();
      dropZone.classList.add('drag-active');
    });

    dropZone.addEventListener('dragleave', () => {
      dropZone.classList.remove('drag-active');
    });

    dropZone.addEventListener('drop', (e) => {
      e.preventDefault();
      dropZone.classList.remove('drag-active');
      handleFiles(e.dataTransfer.files);
    });

    fileInput.addEventListener('change', (e) => {
      handleFiles(e.target.files);
      fileInput.value = '';
    });

    function handleFiles(files) {
      const validFiles = Array.from(files).filter(file => 
        file.type.match(/image\/(jpeg|jpg|png|webp)/)
      );

      validFiles.forEach(file => {
        const reader = new FileReader();
        reader.onload = (e) => {
          images.push({
            id: Date.now() + Math.random(),
            name: file.name,
            data: e.target.result,
            file: file
          });
          renderImages();
        };
        reader.readAsDataURL(file);
      });
    }

    function renderImages() {
      imageGrid.innerHTML = '';
      images.forEach((img, index) => {
        const div = document.createElement('div');
        div.className = 'image-item relative rounded-xl overflow-hidden group';
        div.style.background = 'rgba(99, 102, 241, 0.2)';
        div.draggable = true;
        div.dataset.index = index;

        div.innerHTML = `
          <div class="aspect-square">
            <img src="${img.data}" alt="${img.name}" class="w-full h-full object-cover">
          </div>
          <div class="absolute inset-0 bg-black/50 opacity-0 group-hover:opacity-100 transition-opacity flex items-center justify-center">
            <button class="delete-btn p-2 rounded-full bg-red-500 hover:bg-red-600 transition-colors" data-id="${img.id}">
              <svg class="w-5 h-5" fill="none" stroke="white" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"/>
              </svg>
            </button>
          </div>
          <div class="absolute bottom-0 left-0 right-0 p-2 bg-gradient-to-t from-black/70 to-transparent">
            <p class="text-xs text-white truncate">${index + 1}. ${img.name}</p>
          </div>
        `;

        // Drag events
        div.addEventListener('dragstart', handleDragStart);
        div.addEventListener('dragend', handleDragEnd);
        div.addEventListener('dragover', handleDragOver);
        div.addEventListener('drop', handleDrop);
        div.addEventListener('dragleave', handleDragLeave);

        // Delete button
        div.querySelector('.delete-btn').addEventListener('click', (e) => {
          e.stopPropagation();
          const id = parseFloat(e.currentTarget.dataset.id);
          images = images.filter(img => img.id !== id);
          renderImages();
        });

        imageGrid.appendChild(div);
      });

      imageCount.textContent = images.length;
      settingsContainer.classList.toggle('hidden', images.length === 0);
      previewContainer.classList.toggle('hidden', images.length === 0);
      convertSection.classList.toggle('hidden', images.length === 0);
      successSection.classList.add('hidden');
    }

    // Drag and drop reordering
    function handleDragStart(e) {
      draggedItem = this;
      this.classList.add('dragging');
      e.dataTransfer.effectAllowed = 'move';
    }

    function handleDragEnd() {
      this.classList.remove('dragging');
      document.querySelectorAll('.image-item').forEach(item => {
        item.classList.remove('drag-over');
      });
    }

    function handleDragOver(e) {
      e.preventDefault();
      e.dataTransfer.dropEffect = 'move';
      if (this !== draggedItem) {
        this.classList.add('drag-over');
      }
    }

    function handleDragLeave() {
      this.classList.remove('drag-over');
    }

    function handleDrop(e) {
      e.preventDefault();
      this.classList.remove('drag-over');
      
      if (this !== draggedItem) {
        const fromIndex = parseInt(draggedItem.dataset.index);
        const toIndex = parseInt(this.dataset.index);
        
        const [movedItem] = images.splice(fromIndex, 1);
        images.splice(toIndex, 0, movedItem);
        
        renderImages();
      }
    }

    // Clear all
    clearAllBtn.addEventListener('click', () => {
      images = [];
      renderImages();
    });

    // Convert to PDF
    convertBtn.addEventListener('click', async () => {
      if (images.length === 0) return;

      convertBtn.disabled = true;
      convertSection.classList.add('hidden');
      progressSection.classList.remove('hidden');
      successSection.classList.add('hidden');

      try {
        const { jsPDF } = window.jspdf;
        
        // Get settings
        const paperSize = paperSizeSelect.value;
        const orientation = orientationSelect.value.charAt(0);
        const margin = parseFloat(marginInput.value);
        const quality = parseInt(qualityInput.value);
        
        // Handle F4 size (not a standard jsPDF size)
        const pdfSize = paperSize === 'f4' ? [215, 330] : paperSize;
        
        const pdf = new jsPDF(orientation, 'mm', pdfSize);
        const pageWidth = pdf.internal.pageSize.getWidth();
        const pageHeight = pdf.internal.pageSize.getHeight();

        for (let i = 0; i < images.length; i++) {
          progressBar.style.width = `${((i + 1) / images.length) * 100}%`;
          progressText.textContent = `Memproses gambar ${i + 1} dari ${images.length}`;

          if (i > 0) pdf.addPage();

          const img = new Image();
          img.src = images[i].data;
          
          await new Promise((resolve) => {
            img.onload = () => {
              const imgWidth = img.width;
              const imgHeight = img.height;
              
              // Available space with margin
              const availableWidth = pageWidth - (margin * 2);
              const availableHeight = pageHeight - (margin * 2);
              
              const ratio = Math.min(availableWidth / imgWidth, availableHeight / imgHeight);
              const width = imgWidth * ratio;
              const height = imgHeight * ratio;
              const x = (pageWidth - width) / 2;
              const y = (pageHeight - height) / 2;
              
              // Quality setting (1=low, 2=medium, 3=high)
              const compression = quality === 1 ? 'FAST' : quality === 2 ? 'MEDIUM' : 'SLOW';
              
              pdf.addImage(images[i].data, 'JPEG', x, y, width, height, undefined, compression);
              resolve();
            };
          });
        }

        pdf.save('converted-images.pdf');

        progressSection.classList.add('hidden');
        successSection.classList.remove('hidden');
        convertSection.classList.remove('hidden');
      } catch (error) {
        showToast('Gagal mengkonversi PDF', 'error');
        progressSection.classList.add('hidden');
        convertSection.classList.remove('hidden');
      }

      convertBtn.disabled = false;
    });

    function showToast(message, type = 'info') {
      const toast = document.createElement('div');
      toast.className = 'fixed bottom-4 left-1/2 -translate-x-1/2 px-6 py-3 rounded-xl font-medium z-50 animate-pulse';
      toast.style.background = type === 'error' ? '#ef4444' : '#6366f1';
      toast.style.color = '#ffffff';
      toast.textContent = message;
      document.body.appendChild(toast);
      setTimeout(() => toast.remove(), 3000);
    }

    // Element SDK
    async function onConfigChange(config) {
      const c = { ...defaultConfig, ...config };
      
      document.getElementById('app-title').textContent = c.app_title;
      document.getElementById('upload-text').textContent = c.upload_text;
      document.getElementById('convert-btn-text').textContent = c.convert_button_text;

      // Apply colors
      document.getElementById('app-container').style.background = `linear-gradient(135deg, ${c.background_color} 0%, ${adjustColor(c.background_color, 20)} 50%, ${c.background_color} 100%)`;
      document.getElementById('app-title').style.color = c.text_color;
      
      // Surface color for drop zone
      dropZone.style.borderColor = c.surface_color;
      dropZone.style.background = hexToRgba(c.surface_color, 0.1);
      
      // Primary action
      convertBtn.style.background = `linear-gradient(135deg, ${c.primary_action_color}, ${adjustColor(c.primary_action_color, 20)})`;
      
      // Secondary action
      clearAllBtn.style.background = c.secondary_action_color;
    }

    function hexToRgba(hex, alpha) {
      const r = parseInt(hex.slice(1, 3), 16);
      const g = parseInt(hex.slice(3, 5), 16);
      const b = parseInt(hex.slice(5, 7), 16);
      return `rgba(${r}, ${g}, ${b}, ${alpha})`;
    }

    function adjustColor(hex, amount) {
      const num = parseInt(hex.slice(1), 16);
      const r = Math.min(255, Math.max(0, (num >> 16) + amount));
      const g = Math.min(255, Math.max(0, ((num >> 8) & 0x00FF) + amount));
      const b = Math.min(255, Math.max(0, (num & 0x0000FF) + amount));
      return `#${(1 << 24 | r << 16 | g << 8 | b).toString(16).slice(1)}`;
    }

    function mapToCapabilities(config) {
      const c = { ...defaultConfig, ...config };
      return {
        recolorables: [
          {
            get: () => c.background_color,
            set: (v) => { c.background_color = v; window.elementSdk.setConfig({ background_color: v }); }
          },
          {
            get: () => c.surface_color,
            set: (v) => { c.surface_color = v; window.elementSdk.setConfig({ surface_color: v }); }
          },
          {
            get: () => c.text_color,
            set: (v) => { c.text_color = v; window.elementSdk.setConfig({ text_color: v }); }
          },
          {
            get: () => c.primary_action_color,
            set: (v) => { c.primary_action_color = v; window.elementSdk.setConfig({ primary_action_color: v }); }
          },
          {
            get: () => c.secondary_action_color,
            set: (v) => { c.secondary_action_color = v; window.elementSdk.setConfig({ secondary_action_color: v }); }
          }
        ],
        borderables: [],
        fontEditable: undefined,
        fontSizeable: undefined
      };
    }

    function mapToEditPanelValues(config) {
      const c = { ...defaultConfig, ...config };
      return new Map([
        ['app_title', c.app_title],
        ['upload_text', c.upload_text],
        ['convert_button_text', c.convert_button_text]
      ]);
    }

    // Initialize
    if (window.elementSdk) {
      window.elementSdk.init({
        defaultConfig,
        onConfigChange,
        mapToCapabilities,
        mapToEditPanelValues
      });
    } else {
      onConfigChange(defaultConfig);
    }
  </script>
</html>